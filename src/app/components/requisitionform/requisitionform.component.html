<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
/>

<div class="container my-4">
  <!-- Header Section -->
  <div class="text-center p-2 border-bottom">
      <img
        [src]="logoUrl"
        alt="Company Logo"
        class="img-fluid"
        style="max-height: 80px"
      />
    
  </div>
  <div class="text-center p-1 border-bottom">
    <h6 class="mt-2">MANPOWER REQUISITION FORM</h6>
  </div>

  <!-- Basic Details -->
  <div class="row g-3 px-4 border-bottom">
    <!-- Company Name -->
    <div class="col-md-6 position-relative border-right">
      <div class="d-flex gap-2 align-items-center position-relative">
        <label>Company Name: <span class="text-danger">*</span></label>
        <input
          autocomplete="off"
          type="text"
          (keypress)="onKeyPress($event)"
          class="form-control pe-4"
          [(ngModel)]="buSearchTerm"
          (input)="onBuSearchChange()"
          placeholder="Search Company"
          name="companyName"
          #companyName="ngModel"
          [ngClass]="{
            'input-error': companyName.invalid && companyName.touched
          }"
          required
        />

        <i
          *ngIf="companyName.touched && companyName.invalid"
          class="fa fa-exclamation-circle position-absolute"
          style="
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
          "
        ></i>

        <ul
          *ngIf="buSearchTerm && filteredBuList.length > 0"
          class="dropdown-menu show"
          style="max-height: 200px; overflow-y: auto"
        >
          <li
            *ngFor="let bu of filteredBuList"
            (click)="onBuSelect(bu)"
            class="list-group-item list-group-item-action"
          >
            {{ bu.name }}
          </li>
        </ul>
      </div>
    </div>

    <div class="col-md-6 position-relative">
      <div class="d-flex gap-2 align-items-center">
        <label>Department: <span class="text-danger">*</span></label>
        <input
          autocomplete="off"
          type="text"
          (keypress)="onKeyPress($event)"
          class="form-control"
          [(ngModel)]="departmentSearchTerm"
          (input)="onDepartmentSearchChange()"
          placeholder="Search Department"
          name="department"
          #department="ngModel"
          [ngClass]="{
            'input-error': department.invalid && department.touched
          }"
          required
        />
        <i
          *ngIf="department.touched && department.invalid"
          class="fa fa-exclamation-circle position-absolute"
          style="
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
          "
        ></i>
        <ul
          *ngIf="departmentSearchTerm && filteredDepartments.length > 0"
          class="dropdown-menu show"
          style="max-height: 200px; overflow-y: auto"
        >
          <li
            *ngFor="let dept of filteredDepartments"
            (click)="onDepartmentSelect(dept)"
            class="list-group-item list-group-item-action"
          >
            {{ dept.name }}
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-6 border-right position-relative">
      <div class="d-flex align-items-center gap-2">
        <label>Location: <span class="text-danger">*</span></label>
        <input
          autocomplete="off"
          type="text"
          maxlength="150"
          class="form-control"
          [(ngModel)]="location"
          placeholder="Enter location"
          name="location"
          #locationModel="ngModel"
          [ngClass]="{
            'input-error': locationModel.invalid && locationModel.touched
          }"
          required
        />
        <i
          *ngIf="locationModel.touched && locationModel.invalid"
          class="fa fa-exclamation-circle position-absolute"
          style="
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
          "
        ></i>
      </div>
    </div>

    <div class="col-md-6 position-relative">
      <div class="d-flex align-items-center gap-2">
        <label>Experience Required: <span class="text-danger">*</span></label>
        <input
          autocomplete="off"
          type="text"
          class="form-control"
          [(ngModel)]="experienceRequired"
          placeholder="Enter experience"
          name="experienceRequired"
          #experienceModel="ngModel"
          maxlength="4"
          [ngClass]="{
            'input-error': experienceModel.invalid && experienceModel.touched
          }"
          (keypress)="onKey($event)"
          required
        />
        <i
          *ngIf="experienceModel.touched && experienceModel.invalid"
          class="fa fa-exclamation-circle position-absolute"
          style="
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
          "
        ></i>
      </div>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-6 position-relative border-right">
      <div class="d-flex gap-2 align-items-center">
        <label>Job Title: <span class="text-danger">*</span></label>
        <input
          autocomplete="off"
          (keypress)="onKeyPress($event)"
          type="text"
          class="form-control"
          [(ngModel)]="designationSearchTerm"
          (input)="onDesignationSearchChange()"
          placeholder="Search Designation"
          name="jobTitle"
          #jobTitle="ngModel"
          [ngClass]="{
            'input-error': jobTitle.invalid && jobTitle.touched
          }"
          required
        />
        <i
          *ngIf="jobTitle.touched && jobTitle.invalid"
          class="fa fa-exclamation-circle position-absolute"
          style="
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
          "
        ></i>
        <ul
          *ngIf="designationSearchTerm && filteredDesignations.length > 0"
          class="dropdown-menu show"
          style="max-height: 200px; overflow-y: auto"
        >
          <li
            *ngFor="let designation of filteredDesignations"
            (click)="onDesignationSelect(designation)"
            class="list-group-item list-group-item-action"
          >
            {{ designation.name }}
          </li>
        </ul>
      </div>
    </div>
    <div class="col-md-6 position-relative">
      <div class="d-flex align-items-center gap-2">
        <label>Qualification: <span class="text-danger">*</span></label>
        <input
          autocomplete="off"
          type="text"
          class="form-control"
          [(ngModel)]="selectedQualification"
          placeholder="Enter qualification"
          #qualification="ngModel"
          [ngClass]="{
            'input-error': qualification.invalid && qualification.touched
          }"
          required
        />
        <i
          *ngIf="qualification.touched && qualification.invalid"
          class="fa fa-exclamation-circle position-absolute"
          style="
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
          "
        ></i>
      </div>
    </div>
  </div>
  <div class="row g-3 px-4 border-bottom">
    <!-- Requirements & Description -->
    <div class="col-md-12 position-relative">
      <div class="gap-2">
        <label style="white-space: nowrap"
          >Requirements & Job Description
          <span class="text-danger">*</span></label
        >
        <textarea
          [(ngModel)]="jobDescription"
          class="form-control"
          placeholder="Enter job description"
          style="height: 100px"
          name="jobDescription"
          #jobDescriptionField="ngModel"
          maxlength="500"
          [ngClass]="{
            'input-error':
              jobDescriptionField.invalid && jobDescriptionField.touched
          }"
          required
        ></textarea>

        <i
          *ngIf="jobDescriptionField.touched && jobDescriptionField.invalid"
          class="fa fa-exclamation-circle position-absolute"
          style="
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
          "
        ></i>
      </div>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <!-- Special Skills Input -->
    <div class="col-md-12 postion-relative">
      <div class="gap-2">
        <label class="mb-0" for="specialSkills" style="white-space: nowrap">
          Special Skills (Managerial & Functional)
          <span class="text-danger">*</span>
        </label>
        <textarea
          id="specialSkills"
          [(ngModel)]="specialSkills"
          class="form-control"
          maxlength="500"
          placeholder="Enter skills required and job description"
          style="height: 100px"
          name="specialSkills"
          #specialSkillsField="ngModel"
          [ngClass]="{
            'input-error':
              specialSkillsField.invalid && specialSkillsField.touched
          }"
          required
        ></textarea>

        <i
          *ngIf="specialSkillsField.touched && specialSkillsField.invalid"
          class="fa fa-exclamation-circle position-absolute"
          style="
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #dc3545;
          "
        ></i>
      </div>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-12">
      <p class="mt-2">
        Reasons for vacancy: Resignation/Abscond/New position (for replacement,
        fill details below)
      </p>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-12">
      <div class="d-flex align-items-center gap-2">
        <label>Name of the replaced employee:</label>
        <ng-container *ngIf="employeeData.empNo; else replacedNameInput">
          <span class="emp-no-text"> {{ employeeData.employeeName }}</span>
        </ng-container>
        <ng-template #replacedNameInput>
          <input
            autocomplete="off"
            type="text"
            [(ngModel)]="employeeData.employeeName"
            class="form-control"
            placeholder="Enter name"
            name="employeeName"
            #employeeNameField="ngModel"
            required
          />
          <!-- <div *ngIf="employeeNameField.touched && employeeNameField.invalid" class="text-danger">
                Employee name is required when replacing an employee.
              </div> -->
        </ng-template>
      </div>
    </div>
  </div>
  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-4 position-relative border-right">
      <div class="d-flex align-items-center gap-2 w-100">
        <label>Emp No:</label>

        <input
          autocomplete="off"
          type="text"
          maxlength="6"
          [(ngModel)]="employeeSearch"
          (input)="onEmpNoChange(employeeSearch)"
          (blur)="hideDropdownWithDelay()"
          placeholder="Enter Emp No"
          class="form-control"
          name="empNo"
        />

        <ul
          *ngIf="filteredEmployees.length && showDropdown"
          class="dropdown-menu show"
          style="
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            z-index: 1050;
          "
        >
          <li
            *ngFor="let emp of filteredEmployees"
            class="dropdown-item"
            (click)="selectEmployee(emp)"
          >
            {{ emp.id }} - {{ emp.name }}
          </li>
        </ul>
      </div>
    </div>

    <div class="col-md-4 border-right">
      <div class="d-flex align-items-center gap-2">
        <label>Qualification:</label>
        <ng-container *ngIf="employeeData.empNo; else qualificationInput">
          <span class="emp-no-text"> {{ employeeData.qualification }}</span>
        </ng-container>
        <ng-template #qualificationInput>
          <input
            autocomplete="off"
            type="text"
            [(ngModel)]="employeeData.qualification"
            placeholder="Enter qualification"
            class="form-control"
          />
        </ng-template>
      </div>
    </div>

    <div class="col-md-4">
      <div class="d-flex align-items-center gap-2">
        <label>Date of Resignation:</label>
        <ng-container *ngIf="employeeData.empNo; else resignationInput">
          <span class="emp-no-text">{{ employeeData.dateOfResignation }}</span>
        </ng-container>
        <ng-template #resignationInput>
          <input
            autocomplete="off"
            bsDatepicker
            (keypress)="allowOnlyNumbers($event)"
            placeholder="Select date"
            type="text"
            [(ngModel)]="employeeData.dateOfResignation"
            class="form-control"
            name="dateOfResignation"
            #dateOfResignationField="ngModel"
            required
            [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }"
          />
        </ng-template>
      </div>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-4 border-right">
      <div class="d-flex align-items-center gap-2">
        <label>Designation:</label>
        <ng-container *ngIf="employeeData.empNo; else designationInput">
          <span class="emp-no-text"> {{ employeeData.designation }}</span>
        </ng-container>
        <ng-template #designationInput>
          <input
            autocomplete="off"
            type="text"
            [(ngModel)]="employeeData.designation"
            placeholder="Enter designation"
            class="form-control"
            name="designation"
            #designationField="ngModel"
            required
          />
          <!-- <div *ngIf="designationField.touched && designationField.invalid" class="text-danger">
                Designation is required.
              </div> -->
        </ng-template>
      </div>
    </div>

    <div class="col-md-4 border-right">
      <div class="d-flex align-items-center gap-2">
        <label>Experience:</label>
        <ng-container *ngIf="employeeData.empNo; else experienceInput">
          <span class="emp-no-text"> {{ employeeData.experience }}</span>
        </ng-container>
        <ng-template #experienceInput>
          <input
            autocomplete="off"
            type="text"
            [(ngModel)]="employeeData.experience"
            placeholder="Enter experience"
            class="form-control"
            name="experience"
            #experienceField="ngModel"
            required
          />
          <!-- <div *ngIf="experienceField.touched && experienceField.invalid" class="text-danger">
                Experience is required.
              </div> -->
        </ng-template>
      </div>
    </div>

    <div class="col-md-4">
      <div class="d-flex align-items-center gap-2">
        <label>Date of Relieving:</label>
        <ng-container *ngIf="employeeData.empNo; else relievingInput">
          <span class="emp-no-text">{{ employeeData.dateOfRelieving }}</span>
        </ng-container>
        <ng-template #relievingInput>
          <input
            autocomplete="off"
            bsDatepicker
            placeholder="Select date"
            (keypress)="allowOnlyNumbers($event)"
            type="text"
            [(ngModel)]="employeeData.dateOfRelieving"
            class="form-control"
            name="dateOfRelieving"
            #dateOfRelievingField="ngModel"
            [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }"
            required
          />
          <!-- <div *ngIf="dateOfRelievingField.touched && dateOfRelievingField.invalid" class="text-danger">
                Date of Relieving is required.
              </div> -->
        </ng-template>
      </div>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom" style="height: 50px"></div>
  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-6 pt-2 border-right">
      <label>Dept Head Sign:</label>
    </div>
    <div class="col-md-6 pt-2">
      <label>Unit Head Sign:</label>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-6 position-relative border-right">
      <div class="d-flex align-items-center gap-2">
        <label for="deptHeadName">Dept Head Name:</label>
        <input
          autocomplete="off"
          type="text"
          id="deptHeadName"
          class="form-control"
          [(ngModel)]="deptHeadName"
          name="deptHeadName"
          placeholder="Enter Dept Head Name"
          (input)="onDeptHeadNameInput()"
          autocomplete="off"
        />
        <ul
          class="dropdown-menu show"
          *ngIf="showDeptHeadDropdown && deptHeadSearchResults.length > 0"
          style="max-height: 200px; overflow-y: auto"
        >
          <li
            class="dropdown-item"
            *ngFor="let head of deptHeadSearchResults"
            (click)="selectDeptHead(head)"
          >
            {{ head.id }} - {{ head.name }}
          </li>
        </ul>
      </div>
    </div>

    <div class="col-md-6 position-relative">
      <div class="d-flex align-items-center gap-2">
        <label for="unitHeadName">Unit Head Name:</label>
        <input
          autocomplete="off"
          type="text"
          id="unitHeadName"
          [(ngModel)]="unitHeadName"
          class="form-control"
          placeholder="Enter Unit Head Name"
          (input)="onUnitHeadNameInput()"
          autocomplete="off"
        />
      </div>

      <ul
        class="dropdown-menu show"
        *ngIf="showUnitHeadDropdown && unitHeadSearchResults.length > 0"
        style="max-height: 200px; overflow-y: auto"
      >
        <li
          class="dropdown-item"
          *ngFor="let head of unitHeadSearchResults"
          (click)="selectUnitHead(head)"
        >
          {{ head.id }} - {{ head.name }}
        </li>
      </ul>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-6 border-right">
      <div class="d-flex align-items-center gap-2">
        <label>Date:</label>
        <input
          autocomplete="off"
          type="text"
          bsDatepicker
          (keypress)="allowOnlyNumbers($event)"
          [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }"
          [(ngModel)]="deptHeadDate"
          placeholder="Select Date"
          class="form-control"
          name="deptHeadDate"
          #deptHeadDateField="ngModel"
          required
        />
        <!-- <div *ngIf="deptHeadDateField.touched && deptHeadDateField.invalid" class="text-danger">
  Dept Head Date is required.
</div> -->
      </div>
    </div>

    <div class="col-md-6">
      <div class="d-flex align-items-center gap-2">
        <label>Date:</label>
        <input
          autocomplete="off"
          [bsConfig]="{ dateInputFormat: 'YYYY-MM-DD' }"
          type="text"
          placeholder="Select Date"
          bsDatepicker
          (keypress)="allowOnlyNumbers($event)"
          [(ngModel)]="unitHeadDate"
          class="form-control"
          name="unitHeadDate"
          #unitHeadDateField="ngModel"
          required
        />
        <!-- <div *ngIf="unitHeadDateField.touched && unitHeadDateField.invalid" class="text-danger">
              Unit Head Date is required.
            </div> -->
      </div>
    </div>
  </div>
  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-12 mt-4 postion-relative">
      <label for="hrComments"
        >HR Department Comments: <span class="text-danger">*</span></label
      >
      <textarea
        id="hrComments"
        [(ngModel)]="hrComments"
        class="form-control"
        placeholder="Enter comments"
        style="height: 100px"
        name="hrComments"
        #hrCommentsField="ngModel"
        maxlength="500"
        required
      ></textarea>
      <i
        *ngIf="hrCommentsField.touched && hrCommentsField.invalid"
        class="fa fa-exclamation-circle position-absolute"
        style="
          right: 10px;
          top: 50%;
          transform: translateY(-50%);
          color: #dc3545;
        "
      ></i>
    </div>
  </div>

  <div class="row g-3 px-4 border-bottom">
    <div class="col-md-6">
      <div class="d-flex justify-content-between mt-4">
        <div><p>HR Department</p></div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="d-flex justify-content-end mt-4">
        <div><p>Director - HR & Admin.</p></div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="text-center my-2">
      <button
        class="btn btn-primary"
        (click)="onSubmit()"
        [disabled]="!formValid()"
      >
        Submit
      </button>
    </div>
  </div>
</div>
